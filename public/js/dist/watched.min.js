(function(global,factory){if(typeof global.d3!=="object"||typeof global.d3.version!=="string")throw new Error("watched requires d3v4");var v=global.d3.version.split(".");if(v[0]!="4")throw new Error("watched requires d3v4");if(typeof global.bs!=="object"||typeof global.bs.version!=="string")throw new Error("watched require d3-Bootstrap");factory(global.wd=global.wd||{},d3,global)})(this,function(wd,d3,global){var lang="en-US";var langArray={};wd.format=wd.format||{};wd.componant=wd.componant||{};wd.chart=wd.chart||{};wd.lang=wd.lang||{};d3.dispatch.prototype.register=function(){for(var i=0,n=arguments.length,_={},t;i<n;++i){if(!(t=arguments[i]+"")||t in this._)throw new Error("illegal type: "+t);this._[t]=[]}};wd.format.dateAxe=function(date){var locale=d3.timeFormatLocale({dateTime:"%A, le %e %B %Y, %X",date:"%Y-%m-%d",time:"%H:%M",periods:["AM","PM"],days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDays:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],months:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],shortMonths:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."]}),formatMillisecond=locale.format(".%L"),formatSecond=locale.format(":%S"),formatMinute=locale.format("%X"),formatHour=locale.format("%X"),formatDay=locale.format("%x"),formatWeek=locale.format("%x"),formatMonth=locale.format("%x"),formatYear=locale.format("%Y");return(d3.timeSecond(date)<date?formatMillisecond:d3.timeMinute(date)<date?formatSecond:d3.timeHour(date)<date?formatMinute:d3.timeDay(date)<date?formatHour:d3.timeMonth(date)<date?d3.timeWeek(date)<date?formatDay:formatWeek:d3.timeYear(date)<date?formatMonth:formatYear)(date)};wd.format.date=function(date){var locale=d3.timeFormatLocale({dateTime:"%A, le %e %B %Y, %X",date:"%Y-%m-%d",time:"%H:%M",periods:["AM","PM"],days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDays:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],months:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],shortMonths:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."]});return locale.format("%x %X")(date)};wd.format.number=bs.api.format.number;wd.dispatch=d3.dispatch("ready");wd.lang.set=function(l,f){lang=l;d3.json(f,function(results){langArray=results;wd.dispatch.call("ready")})};wd.lang.tr=function(txt){if(typeof txt!=="string")return"";if(typeof langArray!=="object")return txt;if(typeof langArray[txt]==="string")return langArray[txt];return txt};wd.componant.base=function(){var data=[],called=false,ready=false,root;function chart(s){called=true;s.each(chart.init);return chart}chart.callbacks={};chart.dispatch=d3.dispatch("init","renderUpdate","dataUpdate");chart.inited=function(){return called};chart.ready=function(){return ready};chart.init=function(){root=d3.select(this);chart.dispatch.call("init");if(ready)chart.dispatch.call("renderUpdate")};chart.onTop=function(s){return s.each(function(){this.parentNode.appendChild(this)})};chart.root=function(_){if(arguments.length){root=_;return chart}else if(chart.inited())return root;else return false};chart.data=function(_){if(!arguments.length)return data;if(typeof _!="object"||typeof _[0]=="undefined")return chart;data=_;ready=true;chart.dispatch.call("dataUpdate");if(chart.inited())chart.dispatch.call("renderUpdate");return chart};return chart};wd.componant.colored=function(pClass,pColor){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.base(),color=typeof pColor!="undefined"&&pColor!=null?pColor:d3.scaleOrdinal(d3.schemeCategory10);chart.dispatch.register("colorUpdate");chart.color=function(_){if(!arguments.length)return color;color=_;chart.dispatch.call("colorUpdate");return chart};return chart};wd.componant.sized=function(pClass,pW,pH){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.base(),width=typeof pW!="undefined"&&pW!=null?pW:0,height=typeof pH!="undefined"&&pH!=null?pH:0;chart.dispatch.register("heightUpdate","widthUpdate");chart.width=function(_){if(!arguments.length)return width;width=_;chart.dispatch.call("widthUpdate");return chart};chart.height=function(_){if(!arguments.length)return height;height=_;chart.dispatch.call("heightUpdate");return chart};return chart};wd.componant.minSized=function(pClass,pW,pH){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.sized(null,pW,pH),minWidth=typeof pW!="undefined"&&pW!=null?pW:0,minHeight=typeof pH!="undefined"&&pH!=null?pH:0,pWidth=chart.width,pHeight=chart.height;chart.updateSizeFromMin=function(){pWidth(minWidth);pHeight(minHeight)};chart.width=function(_){if(!arguments.length)return pWidth();if(_>minWidth)return pWidth(_);return chart};chart.height=function(_){if(!arguments.length)return pHeight();if(_>minHeight)return pHeight(_);return chart};return chart};wd.componant.axed=function(pClass,pW,pH){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.sized(null,pW,pH);chart.xAxis=d3.scaleTime().range([0,chart.width()]);chart.yAxis=d3.scaleLinear().range([chart.height(),0]);chart.dispatch.on("widthUpdate.wd.componant.axed",function(){chart.xAxis.range([0,chart.width()])});chart.dispatch.on("heightUpdate.wd.componant.axed",function(){chart.yAxis.range([chart.height(),0])});chart.dispatch.on("dataUpdate.wd.componant.axed",function(){chart.xAxis.domain(d3.extent(chart.data(),function(d){return d.timestamp}));chart.yAxis.domain([0,d3.max(chart.data(),function(d){var keys;if(typeof chart.filter!="undefined")keys=Object.keys(d).filter(chart.filter());else keys=Object.keys(d);var vals=keys.map(function(i){return d[i]});return d3.max(vals)})])});return chart};wd.componant.axes=function(pClass,pW,pH){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.axed(null,pW,pH);chart.xAxisLine=function(g){g.call(d3.axisBottom(chart.xAxis).tickFormat(wd.format.dateAxe));g.select(".domain").remove();g.selectAll(".tick line").attr("stroke","lightgrey").style("stroke-width","1.5px")};chart.yAxisLine=function(g){g.call(d3.axisRight(chart.yAxis).tickSize(chart.width()));g.select(".domain").remove();g.selectAll(".tick line").attr("stroke","lightgrey").style("stroke-width","1px");g.selectAll(".tick:not(:first-of-type) line").attr("stroke-dasharray","5,5");g.selectAll(".tick text").attr("x",-20)};chart.dispatch.on("init.wd.componant.axes",function(){chart.root().append("g").attr("class","x axis").attr("transform","translate(0,"+chart.height()+")").call(chart.xAxisLine);chart.root().append("g").attr("class","y axis").call(chart.yAxisLine)});chart.dispatch.on("heightUpdate.wd.componant.axes",function(){if(chart.inited())chart.root().select(".x.axis").attr("transform","translate(0,"+chart.height()+")")});chart.dispatch.on("renderUpdate.wd.componant.axes",function(){var update=chart.root().transition();update.select(".x.axis").duration(150).call(chart.xAxisLine);update.select(".y.axis").duration(150).call(chart.yAxisLine)});return chart}});(function(global,factory){if(typeof global.d3!=="object"||typeof global.d3.version!=="string")throw new Error("watched requires d3v4");var v=global.d3.version.split(".");if(v[0]!="4")throw new Error("watched requires d3v4");if(typeof global.bs!=="object"||typeof global.bs.version!=="string")throw new Error("watched require d3-Bootstrap");if(typeof global.wd!=="object")throw new Error("watched donut require watched componant");factory(global.wd,global)})(this,function(wd,global){function wdBarChartBars(pClass){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.colored(wd.componant.axed(null,200,200)),stack=d3.stack();chart.xAxis=d3.scaleBand().padding(.2);chart.colorFunction=function(){return chart.color()};chart.dispatch.register("click");chart.dispatch.on("renderUpdate.wdBarChartBars",function(){chart.root().selectAll(".bars").remove();var update=chart.root().selectAll(".bars").data(stack(chart.data()),function(d){return d.type}),eBars=update.enter().append("g").attr("class","bars");update.exit().remove();eBars.append("g").selectAll("rect").data(function(d){d.map(function(i){i.key=d.key});return d}).enter().append("rect").attr("fill",function(d,i){return chart.colorFunction(d,i)(d.key)}).attr("x",function(d){return chart.xAxis(d.data.type)}).attr("y",function(d){return chart.yAxis(d[1])}).attr("height",function(d){return chart.yAxis(d[0])-chart.yAxis(d[1])}).attr("width",chart.xAxis.bandwidth()).on("click",function(d,i){chart.dispatch.call("click",this,d,i)})});chart.dispatch.on("widthUpdate.wd.componant.axed",function(){});chart.dispatch.on("widthUpdate.wdBarChartBars",function(){chart.xAxis.rangeRound([0,chart.width()])});chart.dispatch.on("dataUpdate.wd.componant.axed",function(){});chart.dispatch.on("dataUpdate.wdBarChartBars",function(){var keys=[];Object.keys(chart.data()[0]).map(function(k,i){if(typeof chart.data()[0][k]=="number")keys.push(k)});stack.keys(keys);chart.color().domain(keys);chart.xAxis.domain(chart.data().map(function(d){return d.type}));chart.yAxis.domain([0,d3.max(chart.data(),function(d){var sum=0;Object.keys(d).map(function(k,i){if(typeof d[k]=="number")sum+=d[k]});return sum})])});return chart}function wdBarAxes(pClass){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.axes(null,500,200);chart.xAxis=d3.scaleBand().rangeRound([0,chart.width()]).paddingInner(.05).align(.1);chart.xAxisLine=function(g){g.call(d3.axisBottom(chart.xAxis));g.selectAll(".tick line").attr("stroke","lightgrey").style("stroke-width","1.5px")};chart.dispatch.on("widthUpdate.wd.componant.axed",function(){});chart.dispatch.on("widthUpdate.wdBarAxes",function(){chart.xAxis.rangeRound([0,chart.width()])});chart.dispatch.on("dataUpdate.wd.componant.axed",function(){});chart.dispatch.on("dataUpdate.wdBarAxes",function(){chart.xAxis.domain(chart.data().map(function(d){return d.type}));chart.yAxis.domain([0,d3.max(chart.data(),function(d){var sum=0;Object.keys(d).map(function(k,i){if(typeof d[k]=="number")sum+=d[k]});return sum})])});return chart}wd.chart.bar=function(pClass){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.colored(wd.componant.minSized(null,200,200)),margin={top:10,right:10,bottom:20,left:30},axes=wdBarAxes(),bars=wdBarChartBars();chart.dispatch.on("init.wdBarChart",function(){var bound=chart.root().node().getBoundingClientRect();chart.width(bound.width);chart.height(bound.height);var svg=chart.root().append("svg").attr("width",chart.width()).attr("height",chart.height());svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(bars);svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(axes)});chart.dispatch.on("heightUpdate.wdBarChart",function(){axes.height(chart.height()-margin.top-margin.bottom);bars.height(chart.height()-margin.top-margin.bottom)});chart.dispatch.on("widthUpdate.wdBarChart",function(){axes.width(chart.width()-margin.left-margin.right);bars.width(chart.width()-margin.left-margin.right)});chart.dispatch.on("dataUpdate.wdBarChart",function(){axes.data(chart.data());bars.data(chart.data())});chart.dispatch.on("colorUpdate.wdBarChart",function(){bars.color(chart.color())});chart.bars=function(){return bars};chart.updateSizeFromMin();return chart};wd.chart.memBar=function(){var chart=wd.chart.bar();var cmem=d3.scaleOrdinal(["#00a65a","#cccccc"]).domain(["used","free"]);var cswap=d3.scaleOrdinal(["#dd4b39","#cccccc"]).domain(["used","free"]);chart.bars().colorFunction=function(d){if(d.data.type=="memory")return cmem;return cswap};chart.bars().dispatch.on("click.watchedMemSwap",function(d){window.location.href=d.data.url});return chart}});(function(global,factory){if(typeof global.d3!=="object"||typeof global.d3.version!=="string")throw new Error("watched requires d3v4");var v=global.d3.version.split(".");if(v[0]!="4")throw new Error("watched requires d3v4");if(typeof global.bs!=="object"||typeof global.bs.version!=="string")throw new Error("watched require d3-Bootstrap");if(typeof global.wd!=="object")throw new Error("watched donut require watched componant");factory(global.wd,global)})(this,function(wd,global){function wdDonutChartLegend(pClass){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.colored();chart.dispatch.register("itemMouseOver","itemMouseOut");chart.callbacks.itemMouseOver=function(d,i){if(!chart.inited())return;var c=chart.color()(i);if(typeof chart.data()[i].color!=="undefined"){c=chart.data()[i].color}chart.root().selectAll("#li-"+i).style("background-color",c).style("font-weight","bold")};chart.callbacks.itemMouseOut=function(d,i){if(!chart.inited())return;chart.root().selectAll("#li-"+i).style("background-color","white").style("font-weight","normal")};chart.dispatch.on("init.wd.chart.donutLegend",function(){chart.dispatch.on("itemMouseOver.legend",chart.callbacks.itemMouseOver).on("itemMouseOut.legend",chart.callbacks.itemMouseOut)});chart.dispatch.on("renderUpdate.wd.chart.donutLegend",function(){chart.root().selectAll("li").selectAll("i").remove();chart.root().selectAll("li").selectAll("span").remove();var update=chart.root().selectAll("li").data(chart.data(),function(d){return d?d.label:this.id}),liHtml=update.enter().append("li").merge(update).attr("id",function(d,i){return"li-"+i});liHtml.append("i").attr("class","fa fa-circle-o").attr("style",function(d,i){if(typeof d.color!=="undefined")return"color:"+d.color+";";return"color:"+chart.color()(i)+";"});liHtml.append("span").text(function(d){return" "+d.label});liHtml.append("span").attr("class","pull-right").text(function(d){if(typeof d.value=="number")return wd.format.number(d.value);return d.value});liHtml.on("mouseover",function(d,i){chart.dispatch.call("itemMouseOver",null,d,i)}).on("mouseout",function(d,i){chart.dispatch.call("itemMouseOut",null,d,i)});update.exit().remove()});return chart}function wdDonutChartDonut(pClass){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.colored(wd.componant.minSized(null,150,150)),radius=chart.width()/2-3,arc=d3.arc().outerRadius(radius).innerRadius(radius/2).padAngle(.01).cornerRadius(3),arc2=d3.arc().outerRadius(radius+3).innerRadius(radius/2-3).padAngle(0).cornerRadius(3),allPies,allPaths;chart.dispatch.register("itemMouseOver","itemMouseOut");chart.callbacks["itemMouseOver"]=function(d,i){if(!chart.inited())return;var c=chart.color()(i);if(typeof chart.data()[i].color!=="undefined"){c=chart.data()[i].color}chart.root().selectAll("#arc-"+i).attr("d",arc2)};chart.callbacks["itemMouseOut"]=function(d,i){if(!chart.inited())return;chart.root().selectAll("#arc-"+i).attr("d",arc)};chart.updateArcs=function(){if(!chart.inited())return;radius=Math.min(chart.width(),chart.height())/2-3;arc.outerRadius(radius).innerRadius(radius/2);arc2.outerRadius(radius+3).innerRadius(radius/2-3);allPaths.attr("d",arc);allPies.attr("transform","translate("+[chart.width()/2,chart.height()/2]+")")};chart.loadtween=function(d,i){var interpolate=d3.interpolate(d.startAngle,d.endAngle);return function(t){d.endAngle=interpolate(t);return arc(d)}};chart.dispatch.on("itemMouseOver.donut",chart.callbacks["itemMouseOver"]).on("itemMouseOut.donut",chart.callbacks["itemMouseOut"]);chart.dispatch.on("init.wd.chart.donutDonut",function(){chart.root().attr("width",chart.width()).attr("height",chart.height());var chartLayer=chart.root().append("g").classed("chartLayer",true);allPies=chartLayer.selectAll(".pies");allPaths=chartLayer.selectAll(".arcPath")});chart.dispatch.on("renderUpdate.wd.chart.donutDonut",function(){chart.root().selectAll("path").remove();var update=allPies.data(chart.data()),arcs=d3.pie().sort(null).value(function(d){return d.value})(chart.data()),pies=update.enter().append("g").classed("pies",true).attr("transform","translate("+[chart.width()/2,chart.height()/2]+")"),blocks=pies.selectAll(".arc").data(arcs),newBlock=blocks.enter().append("g").classed("arc",true);newBlock.append("path").classed("arcPath",true).attr("d",arc).attr("stroke","white").style("stroke-width","0.5").attr("id",function(d,i){return"arc-"+i}).attr("fill","white").on("mouseover",function(d,i){chart.dispatch.call("itemMouseOver",null,d,i)}).on("mouseout",function(d,i){chart.dispatch.call("itemMouseOut",null,d,i)}).transition().duration(350).delay(function(d,i){return i*50}).attr("fill",function(d,i){if(typeof chart.data()[i].color!=="undefined")return chart.data()[i].color;return chart.color()(i)}).attrTween("d",chart.loadtween);update.exit().remove()});chart.dispatch.on("heightUpdate.wd.chart.donutDonut",function(){chart.updateArcs();if(chart.inited())chart.root().attr("height",chart.height())});chart.dispatch.on("widthUpdate.wd.chart.donutDonut",function(){chart.updateArcs();if(chart.inited())chart.root().attr("width",chart.width())});return chart}wd.chart.donut=function(pClass){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.colored(),legend=wdDonutChartLegend(),donut=wdDonutChartDonut(),width,height,rightHtml;chart.dispatch.on("init.wd.chart.donut",function(){var rowHtml=chart.root().append("div").attr("class","row"),leftHtml=rowHtml.append("div").attr("class","col-xs-12 col-sm-8 col-md-12 col-lg-7").append("div").attr("class","chart-responsive");rightHtml=rowHtml.append("div").attr("class","col-xs-12 col-sm-4 col-md-12 col-lg-5");rightHtml.append("ul").attr("class","list-unstyled clearfix").call(legend);leftHtml.append("svg").call(donut);legend.color(chart.color()).data(chart.data());width=leftHtml.node().getBoundingClientRect().width;height=rightHtml.node().getBoundingClientRect().height;donut.width(width).height(height).color(chart.color()).data(chart.data());legend.dispatch.on("itemMouseOver.donut",donut.callbacks["itemMouseOver"]);legend.dispatch.on("itemMouseOut.donut",donut.callbacks["itemMouseOut"]);donut.dispatch.on("itemMouseOver.legend",legend.callbacks["itemMouseOver"]);donut.dispatch.on("itemMouseOut.legend",legend.callbacks["itemMouseOut"])});chart.dispatch.on("renderUpdate.wd.chart.donut",function(){height=rightHtml.node().getBoundingClientRect().height;donut.height(height).data(chart.data())});chart.dispatch.on("colorUpdate.wd.chart.donut",function(){legend.color(chart.color());donut.color(chart.color())});return chart}});(function(global,factory){if(typeof global.d3!=="object"||typeof global.d3.version!=="string")throw new Error("watched requires d3v4");var v=global.d3.version.split(".");if(v[0]!="4")throw new Error("watched requires d3v4");if(typeof global.bs!=="object"||typeof global.bs.version!=="string")throw new Error("watched require d3-Bootstrap");if(typeof global.wd!=="object")throw new Error("watched donut require watched componant");factory(global.wd,global)})(this,function(wd,global){function wdTableBodyChart(pClass){var chart=typeof pClass!="undefined"&&pClass!=null?pClass:wd.componant.base(),keys=[],heads,rows;chart.dispatch.on("init.wdTableBodyChart",function(){heads=chart.root().selectAll("thead th.sortable").on("click",function(d,i){if(typeof rows=="undefined")return;chart.root().selectAll("thead th.sortable").selectAll("i").attr("class","fa fa-sort pull-right");if(typeof this.sortType=="undefined")this.sortType="desc";else if(this.sortType=="asc")this.sortType="desc";else this.sortType="asc";if(this.sortType=="asc"){d3.select(this).select("i").attr("class","fa fa-sort-up pull-right");rows.sort(function(a,b){if(a[keys[i]]==null)return false;if(b[keys[i]]==null)return true;if(typeof a[keys[i]]=="object")return a[keys[i]].text>b[keys[i]].text;return a[keys[i]]>b[keys[i]]})}else{d3.select(this).select("i").attr("class","fa fa-sort-down pull-right");rows.sort(function(a,b){if(a[keys[i]]==null)return true;if(b[keys[i]]==null)return false;if(typeof a[keys[i]]=="object")return a[keys[i]].text<b[keys[i]].text;return a[keys[i]]<b[keys[i]]})}}).append("i").attr("class","fa fa-sort pull-right")});chart.dispatch.on("renderUpdate.wdTableBodyChart",function(){var update=chart.root().select("tbody").selectAll("tr").data(chart.data());update.exit().remove();if(typeof chart.data()[0]=="undefined")return;keys=Object.keys(chart.data()[0]);rows=update.enter().append("tr").each(function(d){if(typeof d.rowProperties=="object"&&d.rowProperties!=null){if(typeof d.rowProperties.color!="undefined")d3.select(this).attr("class",d.rowProperties.color)}});rows.selectAll("td").data(function(d,i){var j=0,ret=[],r={},haverp=false;if(d.hasOwnProperty("rowProperties")&&typeof d.rowProperties=="object"&&d.rowProperties!=null){r=d["rowProperties"];haverp=true}for(var k in d){if(!d.hasOwnProperty(k)||k=="rowProperties")continue;ret.push({id:++j,rowid:i,name:k,value:haverp?Object.assign({},r,d[k]):d[k]})}return ret}).enter().append("td").each(function(d,i){if(d.name=="actions"){d3.select(this).attr("class","text-right").selectAll("a").data(d.value).enter().append("a").each(function(p,j){if(typeof p.target!="undefined")d3.select(this).attr("data-toggle","modal").attr("data-target",p.target).append("i").attr("class",p.icon);else d3.select(this).attr("href",p.url).append("i").attr("class",p.icon);d3.select(this).append("span").text(" ")})}else if(typeof d.value=="object"&&d.value!=null){if(typeof d.value.color!="undefined")d3.select(this).attr("class",d.value.color);if(typeof d.value.icon!="undefined")d3.select(this).append("i").attr("class",d.value.icon);if(typeof d.value.url!="undefined"){var a=d3.select(this).append("a").attr("href",d.value.url);if(typeof d.value.color!="undefined")a.attr("class",d.value.color);if(typeof d.value.text=="number"){d3.select(this).classed("text-right",true);a.html(" "+wd.format.number(d.value.text))}else a.html(" "+d.value.text)}else{if(typeof d.value.text=="number")d3.select(this).classed("text-right",true).append("span").html(" "+wd.format.number(d.value.text));else d3.select(this).append("span").html(" "+d.value.text)}}else if(typeof d.value!="undefined"){if(typeof d.value=="number")d3.select(this).classed("text-right",true).html(wd.format.number(d.value));else d3.select(this).html(d.value)}})});return chart}wd.chart.table=function(){var body=wdTableBodyChart(),heads=[];function chart(s){s.each(chart.init);return chart}chart.body=function(t){body.data(t);return chart};chart.heads=function(t){heads=t;return chart};chart.col=function(t,c){if(typeof c=="undefined")c="sortable";heads.push({text:t,class:c});return chart};chart.init=function(){if(d3.select(this).classed("box-body"))d3.select(this).classed("table-responsive",true);var t=d3.select(this).append("table").attr("class","table table-striped table-hover table-responsive");t.append("thead").append("tr").selectAll("th").data(heads).enter().each(function(d,i){d3.select(this).append("th").attr("class",d.class).text(d.text)});t.append("tbody");t.call(body)};return chart}});(function(global,factory){if(typeof global.d3!=="object"||typeof global.d3.version!=="string")throw new Error("watched requires d3v4");var v=global.d3.version.split(".");if(v[0]!="4")throw new Error("watched requires d3v4");if(typeof global.bs!=="object"||typeof global.bs.version!=="string")throw new Error("watched require d3-Bootstrap");if(typeof global.wd!=="object")throw new Error("watched donut require watched componant");factory(global.wd,global)})(this,function(wd,global){wd.chart.gfxLegend=function(){var chart=wd.componant.colored();var bar,prop="";chart.prop=function(_){if(!arguments.length)return prop;prop=_;return chart};chart.dispatch.register("area","enable","select");chart.setValue=function(d,v){chart.root().select("#value_"+d).html(wd.format.number(v));return chart};chart.setValues=function(v){if(typeof v=="undefined")return chart;chart.data().forEach(function(d){if(!chart.root().select("#enable_"+d).classed("activated"))return;switch(chart.root().select("#select_"+d).node().value){case wd.lang.tr("Min"):chart.setValue(d,v["min_"+d]);break;case wd.lang.tr("Avg"):chart.setValue(d,v["avg_"+d]);break;case wd.lang.tr("Max"):chart.setValue(d,v["max_"+d]);break}});return chart};chart.cols=function(){var ret=[];if(chart.inited()&&chart.ready())chart.data().forEach(function(d){if(chart.root().select("#enable_"+d).classed("activated")){switch(chart.root().select("#select_"+d).node().value){case wd.lang.tr("Min"):ret.push("min_"+d);break;case wd.lang.tr("Avg"):ret.push("avg_"+d);break;case wd.lang.tr("Max"):ret.push("max_"+d);break}}});else if(prop!=""&&chart.ready())ret.push("avg_"+prop);else if(chart.ready())chart.data().forEach(function(d){ret.push("avg_"+d)});return ret};chart.colColor=function(c){return chart.color()(c.substring(4))};chart.dispatch.on("dataUpdate.wdGfxLegend",function(){chart.color().domain(chart.data())});chart.dispatch.on("init.wdGfxLegend",function(){bar=chart.root().append("div").attr("class","btn-toolbar").attr("role","toolbar");var l=bar.append("div").attr("class","btn-group").attr("role","group").attr("data-toggle","buttons").append("label").attr("class","btn btn-default item").on("click",function(d){var x=d3.select(this);if(d3.event)d3.event.preventDefault();x.classed("activated",!x.classed("activated"));chart.dispatch.call("area",this,d,x.classed("activated"))});l.append("input").attr("type","checkbox");l.append("i").attr("class","fa fa-area-chart")});chart.dispatch.on("renderUpdate.wdGfxLegend",function(){var d=bar.selectAll("div.btn-group.legend").data(chart.data()),g=d.enter().append("div").attr("class","btn-group legend").attr("role","group").attr("data-toggle","buttons");var l=g.append("label").attr("class",function(d){var ret="btn btn-default item",a="active activated";if(prop==""||d==prop)return ret+" "+a;return ret}).attr("id",function(d){return"enable_"+d}).on("click",function(d){var x=d3.select(this);if(d3.event)d3.event.preventDefault();x.classed("activated",!x.classed("activated"));chart.dispatch.call("enable",this,d,x.classed("activated"))});l.append("input").attr("type","checkbox").attr("checked",function(d){if(prop==""||d==prop)return"true";return"false"});l.append("i").attr("class","fa fa-circle").attr("style",function(d){return"color:"+chart.color()(d)});var s=g.append("select").attr("class","item").attr("style",function(d){return"color:"+chart.color()(d)}).attr("id",function(d){return"select_"+d}).on("change",function(d,i){chart.dispatch.call("select",this,chart.data()[i],chart.root().select("#select_"+chart.data()[i]).node().value)});s.append("option").text(wd.lang.tr("Min"));s.append("option").text(wd.lang.tr("Avg")).attr("selected","true");s.append("option").text(wd.lang.tr("Max"));g.append("div").attr("class","item").append("b").attr("style",function(d){return"color:"+chart.color()(d)}).html(function(d){return d});g.append("div").attr("class","item value").html("0.00").attr("style",function(d){return"color:"+chart.color()(d)}).attr("id",function(d){return"value_"+d})});return chart};wd.chart.gfxAvailLegend=function(){var chart=wd.chart.gfxLegend();var bar;chart.setValues=function(v){if(typeof v=="undefined")return chart;chart.data().forEach(function(d){if(!chart.root().select("#enable_"+d).classed("activated"))return;chart.setValue(d,v[d])});return chart};chart.cols=function(){var ret=[];if(chart.inited()&&chart.ready())chart.data().forEach(function(d){if(chart.root().select("#enable_"+d).classed("activated"))ret.push(d)});else if(chart.ready())return chart.data();return ret};chart.colColor=function(c){return chart.color()(c)};chart.dispatch.on("init.wdGfxLegend",function(){bar=chart.root().append("div").attr("class","btn-toolbar").attr("role","toolbar")});chart.dispatch.on("renderUpdate.wdGfxLegend",function(){var d=bar.selectAll("div.btn-group.legend").data(chart.data()),g=d.enter().append("div").attr("class","btn-group legend").attr("role","group").attr("data-toggle","buttons");var l=g.append("label").attr("class","btn btn-default item active activated").attr("id",function(d){return"enable_"+d}).on("click",function(d){if(d3.event)d3.event.preventDefault();var x=d3.select(this);x.classed("activated",!x.classed("activated"));chart.dispatch.call("enable",this,d,x.classed("activated"))});l.append("input").attr("type","checkbox").attr("checked","true");l.append("i").attr("class","fa fa-circle").attr("style",function(d){return"color:"+chart.color()(d)});g.append("div").attr("class","item").append("b").attr("style",function(d){return"color:"+chart.color()(d)}).html(function(d){return d});g.append("div").attr("class","item value").html("0.00").attr("style",function(d){return"color:"+chart.color()(d)}).attr("id",function(d){return"value_"+d})});chart.color(d3.scaleOrdinal(["#dd4b39","#ff851b","#b3ffb3"]));chart.data(["failed","missing","ok"]);return chart};wd.chart.timeline=function(){var chart=wd.componant.axed(wd.componant.minSized(null,500,60)),legend,svg,useArea=false,brush=d3.brushX(),stack=d3.stack(),line=d3.line().curve(d3.curveBasis).x(function(d){return chart.xAxis(d.timestamp)}).y(function(d){return chart.yAxis(d.value)}),area=d3.area().x(function(d,i){return chart.xAxis(d.data.timestamp)}).y0(function(d){return chart.yAxis(d[0])}).y1(function(d){return chart.yAxis(d[1])});lines=[];chart.dispatch.register("brushed");chart.areaSet=function(d,v){useArea=v;if(v)chart.yAxis.domain([0,d3.max(chart.data(),function(d){var vals=legend.cols().map(function(i){return d[i]});return d3.sum(vals)})]);else chart.yAxis.domain([0,d3.max(chart.data(),function(d){var vals=legend.cols().map(function(i){return d[i]});return d3.max(vals)})]);if(chart.inited()&&chart.ready())chart.dispatch.call("renderUpdate")};chart.legend=function(_){if(!arguments.length)return legend;legend=_;legend.dispatch.on("area.wdGfxTimeLine",chart.areaSet);return chart};chart.brushMove=function(r){svg.select(".brush").call(brush.move,r)};chart.xAxisLine=function(g){g.call(d3.axisBottom(chart.xAxis).tickFormat(wd.format.dateAxe));g.select(".domain").remove();g.selectAll(".tick line").attr("stroke","lightgrey").style("stroke-width","1.5px")};chart.dispatch.on("dataUpdate.wd.componant.axed",function(){chart.xAxis.domain(d3.extent(chart.data(),function(d){return d.timestamp}));chart.yAxis.domain([0,d3.max(chart.data(),function(d){var vals=legend.cols().map(function(i){return d[i]});return d3.max(vals)})]);lines=legend.cols().map(function(i){return{id:i,values:chart.data().map(function(d){return{timestamp:d.timestamp,value:+d[i]}})}})});chart.dispatch.on("heightUpdate.wdGfxTimeLine",function(){brush.extent([[0,0],[chart.width(),chart.height()]]);if(chart.inited())chart.root().select(".x.axis").attr("transform","translate(0,"+chart.height()+")")});chart.dispatch.on("init.wdGfxTimeLine",function(){stack.keys(legend.cols());var bound=chart.root().node().getBoundingClientRect();chart.width(bound.width-30);chart.height(bound.height-20);svg=chart.root().append("svg").attr("width",chart.width()).attr("height",chart.height()+20);svg.append("g").attr("class","x axis").attr("transform","translate(0,"+chart.height()+")").call(chart.xAxisLine);brush.on("brush end",function(){if(d3.event.sourceEvent&&d3.event.sourceEvent.type==="zoom")return;var s=d3.event.selection||chart.xAxis.range();chart.dispatch.call("brushed",this,s,s.map(chart.xAxis.invert,chart.xAxis))});svg.append("g").attr("class","brush").call(brush).call(brush.move,chart.xAxis.range())});chart.dispatch.on("renderUpdate.wdGfxTimeLine",function(){chart.root().selectAll(".lines").remove();if(useArea){var update=svg.selectAll(".lines").data(stack(chart.data()),function(d){return d.timestamp}),eLines=update.enter().append("g").attr("class","lines");update.exit().remove();eLines.append("path").attr("class","area").style("fill",function(d){return legend.colColor(d.key)}).attr("d",area)}else{var update=svg.selectAll(".lines").data(lines,function(d){return d.timestamp}),eLines=update.enter().append("g").attr("class","lines");update.exit().remove();eLines.append("path").attr("class","line").attr("d",function(d){return line(d.values)}).style("stroke",function(d){return legend.colColor(d.id)})}svg.select("g.brush").call(chart.onTop);svg.transition().select(".x.axis").duration(150).call(chart.xAxisLine);
});return chart};wd.chart.gfx=function(){var chart=wd.componant.axes(wd.componant.axed(wd.componant.minSized(null,500,350))),legend,svg,timeline,domain,full_domain,oldX=0,useArea=false,margin={top:10,right:10,bottom:20,left:30},xRev=d3.scaleTime().domain([0,chart.width()-margin.left-margin.right]),w=chart.width()-(margin.left+margin.right+30),h=chart.height()-margin.bottom-margin.top,zoom=d3.zoom().scaleExtent([1,100]),stack=d3.stack(),line=d3.line().curve(d3.curveBasis).x(function(d){return chart.xAxis(d.timestamp)}).y(function(d){return chart.yAxis(d.value)}),area=d3.area().x(function(d,i){return chart.xAxis(d.data.timestamp)}).y0(function(d){return chart.yAxis(d[0])}).y1(function(d){return chart.yAxis(d[1])});lines=[];chart.dispatch.register("updateValues");chart.mouseMove=function(x,y){if(Math.abs(x-oldX)<1)return;oldX=x;var v=chart.data().find(function(d){return d.timestamp>=xRev(x)});chart.dispatch.call("updateValues",null,v)};chart.zoomed=function(){if(d3.event.sourceEvent&&d3.event.sourceEvent.type==="brush")return;var t=d3.event.transform;if(typeof timeline!=="undefined"){timeline.brushMove(chart.xAxis.range().map(t.invertX,t));domain=t.rescaleX(timeline.xAxis).domain()}else{chart.xAxis.domain(full_domain);domain=t.rescaleX(chart.xAxis).domain()}xRev.range(domain);chart.xAxis.domain(domain);chart.lineChanged();chart.noDots();chart.dispatch.call("renderUpdate")};chart.noDots=function(){svg.selectAll(".dots").selectAll("circle").transition().duration(200).attr("r",0);svg.selectAll(".dots").transition().duration(200).on("end",function(){d3.select(this).remove()})};chart.lineChanged=function(){var subData=[];stack.keys(legend.cols());chart.data().forEach(function(d){if(d.timestamp>=domain[0]&&d.timestamp<=domain[1])subData.push(d)});if(useArea)chart.yAxis.domain([0,d3.max(subData,function(d){var vals=legend.cols().map(function(i){return d[i]});return d3.sum(vals)})]);else chart.yAxis.domain([0,d3.max(subData,function(d){var vals=legend.cols().map(function(i){return d[i]});return d3.max(vals)})]);lines=legend.cols().map(function(i){return{id:i,values:subData.map(function(d){return{timestamp:d.timestamp,value:+d[i]}})}});return chart};chart.areaSet=function(d,v){useArea=v;if(chart.inited()&&chart.ready()){chart.lineChanged();chart.noDots();chart.dispatch.call("renderUpdate")}};chart.colChanged=function(d,v){chart.lineChanged();chart.noDots();chart.dispatch.call("renderUpdate");return chart};chart.brushChanged=function(s,r){domain=r;xRev.range(domain);chart.xAxis.domain(domain);svg.select(".zoom").call(zoom.transform,d3.zoomIdentity.scale(w/(s[1]-s[0])).translate(-s[0],0));chart.noDots();chart.lineChanged();chart.dispatch.call("renderUpdate");return chart};chart.legend=function(_){if(!arguments.length)return legend;legend=_;legend.dispatch.on("area.wdGfxChart",chart.areaSet);legend.dispatch.on("enable",chart.colChanged);legend.dispatch.on("select",chart.colChanged);chart.dispatch.on("updateValues.legend",legend.setValues);return chart};chart.timeline=function(_){if(!arguments.length)return timeline;timeline=_;timeline.dispatch.on("brushed",chart.brushChanged);return chart};chart.yAxisLine=function(g){g.call(d3.axisRight(chart.yAxis).tickSize(w));g.select(".domain").remove();g.selectAll(".tick line").attr("stroke","lightgrey").style("stroke-width","1px");g.selectAll(".tick:not(:first-of-type) line").attr("stroke-dasharray","5,5");g.selectAll(".tick text").attr("x",-20)};chart.dispatch.on("widthUpdate.wd.componant.axed",function(){w=chart.width()-(margin.left+margin.right+30);xRev.domain([0,w]);chart.xAxis.range([0,w])});chart.dispatch.on("heightUpdate.wd.componant.axed",function(){h=chart.height()-margin.bottom-margin.top;chart.yAxis.range([h,0]);zoom.translateExtent([[0,0],[w,h]]).extent([[0,0],[w,h]])});chart.dispatch.on("dataUpdate.wd.componant.axed",function(){domain=d3.extent(chart.data(),function(d){return d.timestamp});full_domain=domain;xRev.range(domain);chart.xAxis.domain(domain);chart.lineChanged()});chart.dispatch.on("heightUpdate.wd.componant.axes",function(){if(chart.inited())chart.root().select(".x.axis").attr("transform","translate("+margin.left+","+h+")")});chart.dispatch.on("init.wd.componant.axes",function(){var bound=chart.root().node().getBoundingClientRect();chart.width(bound.width);chart.height(bound.height);chart.dispatch.call("heightUpdate");svg=chart.root().append("svg").attr("width",chart.width()).attr("height",chart.height());svg.on("mousemove",function(){var bBox=svg.node().getBoundingClientRect(),x=d3.event.pageX-bBox.left-margin.left-window.scrollX,y=d3.event.pageY-bBox.top-margin.top-window.scrollY;if(x>=0&&x<=bBox.right-bBox.left-margin.left-margin.right&&y>=0&&y<=bBox.bottom-bBox.top-margin.top-margin.bottom){chart.mouseMove(x,y)}});svg.append("g").attr("class","x axis").attr("transform","translate("+margin.left+","+(chart.height()-margin.bottom)+")").call(chart.xAxisLine);svg.append("g").attr("class","y axis").attr("transform","translate("+margin.left+","+margin.top+")").call(chart.yAxisLine);svg.append("defs").attr("transform","translate("+margin.left+","+margin.top+")").append("clipPath").attr("id","clip").append("rect").attr("width",w).attr("height",h);zoom.on("zoom",chart.zoomed);svg.append("rect").attr("class","zoom").attr("width",chart.width()).attr("height",chart.height()).call(zoom)});chart.dispatch.on("updateValues.wdGfxChart",function(v){chart.noDots();if(typeof v=="undefined")return;var dots=legend.cols().map(function(d,i){return{id:d.substr(4),timestamp:v.timestamp,value:v[d],color:legend.colColor(d),x:chart.xAxis(v.timestamp),y:chart.yAxis(useArea?stack([v])[i][0][1]:v[d])}}),update=svg.selectAll(".dots").data(dots);update.enter().append("g").attr("class","dots").attr("transform","translate("+margin.left+", "+margin.top+")").append("circle").attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y}).attr("stroke",function(d){return d.color}).transition().duration(200).attr("r",5)});chart.drawArea=function(){var update=svg.selectAll(".lines").data(stack(chart.data()),function(d){return d.timestamp}),eLines=update.enter().append("g").attr("class","lines").attr("transform","translate("+margin.left+", "+margin.top+")");update.exit().remove();eLines.append("path").attr("class","area").style("clip-path","url(#clip)").style("fill",function(d){return legend.colColor(d.key)}).attr("d",area)};chart.drawLine=function(){var update=svg.selectAll(".lines").data(lines,function(d){return d.id});var eLines=update.enter().append("g").attr("class","lines").attr("transform","translate("+margin.left+", "+margin.top+")");eLines.append("path").attr("class","line").attr("d",function(d){return line(d.values)}).style("clip-path","url(#clip)").style("stroke",function(d){return legend.colColor(d.id)})};chart.dispatch.on("renderUpdate.wd.componant.axes",function(){svg.selectAll(".lines").remove();if(useArea)chart.drawArea();else chart.drawLine();svg.select("rect.zoom").call(chart.onTop);var update=svg.transition();update.select(".x.axis").duration(350).call(chart.xAxisLine);update.select(".y.axis").duration(350).call(chart.yAxisLine)});return chart}});(function(global,factory){if(typeof global.d3!=="object"||typeof global.d3.version!=="string")throw new Error("watched requires d3v4");var v=global.d3.version.split(".");if(v[0]!="4")throw new Error("watched requires d3v4");if(typeof global.bs!=="object"||typeof global.bs.version!=="string")throw new Error("watched require d3-Bootstrap");if(typeof global.wd!=="object")throw new Error("watched widget require watched componant");factory(global.widget=global.widget||{},global.wd)})(this,function(widget,wd){function wdBaseWidget(){var data={},called=false,ready=false,root,box=bs.box();function chart(s){called=true;s.each(chart.init);return chart}chart.dispatch=d3.dispatch("init","renderUpdate","dataUpdate");chart.inited=function(){return called};chart.ready=function(){return ready};chart.init=function(){root=d3.select(this);chart.dispatch.call("init");if(ready){chart.dispatch.call("renderUpdate");box.update()}};chart.box=function(){return box};chart.body=function(t){if(arguments.length){box.body(t);return chart}return box.body()};chart.footer=function(t){if(arguments.length){box.footer(t);return chart}return box.footer()};chart.title=function(t){if(arguments.length){box.title(t);return chart}return box.title()};chart.root=function(_){if(arguments.length){root=_;return chart}else if(chart.inited())return root;else return false};chart.data=function(_){if(!arguments.length)return data;data=_;ready=true;chart.dispatch.call("dataUpdate");if(typeof data.title!="undefined"){box.title(data.title);box.tool({action:"collapse",icon:"fa fa-minus"})}if(called){chart.dispatch.call("renderUpdate");box.update()}return chart};chart.source=function(_){if(arguments.length)d3.json(_,function(results){chart.data(results)});return chart};chart.dispatch.on("init.wdBaseWidget",function(){chart.root().call(box)});return chart}widget.table=function(){var chart=wdBaseWidget();chart.body(wd.chart.table());chart.dispatch.on("dataUpdate.wdTableWidget",function(){chart.body().body(chart.data().body);chart.body().heads(chart.data().cols)});return chart};widget.donut=function(){var chart=wdBaseWidget();chart.body(wd.chart.donut());chart.dispatch.on("dataUpdate.wdDonutWidget",function(){chart.body().data(chart.data().body);if(typeof chart.data().footer!="undefined"&&chart.data().footer.length>0){chart.footer(bs.pills().data(chart.data().footer))}});return chart};widget.list=function(){var chart=wdBaseWidget();chart.body(bs.list());chart.dispatch.on("dataUpdate.wdListWidget",function(){chart.body().data(chart.data().body)});return chart};widget.progress=function(){var chart=wdBaseWidget();chart.body(bs.list());chart.dispatch.on("dataUpdate.wdProgessListWidget",function(){chart.data().body.forEach(function(d){chart.body().add(bs.progress().title(d.title).url(d.url).data(d.items))})});return chart};widget.properties=function(){var chart=wdBaseWidget();chart.body(bs.descTable());chart.dispatch.on("dataUpdate.wdPropertyWidget",function(){chart.body().data(chart.data().body)});return chart};widget.memSwap=function(){var chart=wdBaseWidget();chart.box().body(wd.chart.memBar());chart.dispatch.on("dataUpdate.wdMemSwapWidget",function(){chart.body().data(chart.data().body)});return chart};widget.gfxRessource=function(){var chart=wdBaseWidget(),body=wd.chart.gfx(),legend=wd.chart.gfxLegend(),footer=wd.chart.timeline();chart.legend=function(_){if(!arguments.length)return legend;legend=_;return chart};chart.box().body(body).tool(legend).footer(footer);body.legend(legend);body.timeline(footer);footer.legend(legend);chart.dispatch.on("dataUpdate.wdRessourceGfxWidget",function(){legend.data(chart.data().cols);body.data(chart.data().data);footer.data(chart.data().data);chart.box().title(chart.data().src.obj_name+" - "+chart.data().src.res_name)});return chart};widget.gfxAvailability=function(){var chart=wdBaseWidget(),body=wd.chart.gfx(),legend=wd.chart.gfxAvailLegend();chart.legend=function(_){if(!arguments.length)return legend;legend=_;return chart};body.legend(legend);body.areaSet("",true);chart.box().body(body).tool(legend);chart.dispatch.on("dataUpdate.gfxAvailability",function(){body.data(chart.data())});return chart};widget.gfxEvent=function(){var chart=wdBaseWidget(),body=wd.chart.gfx(),legend=wd.chart.gfxLegend();chart.legend=function(_){if(!arguments.length)return legend;legend=_;return chart};chart.prop=function(_){if(!arguments.length)return legend.prop();legend.prop(_);return chart};body.legend(legend);chart.box().body(body).tool(legend);chart.dispatch.on("dataUpdate.gfxEvent",function(){legend.data(chart.data().cols);body.data(chart.data().data)});return chart}});

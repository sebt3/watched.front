{% extends "core.twig" %}
{% block title %}Agent {{ agent.host }} {% endblock %}
{% block meta %}
<style>
table.table-hover tr td a {
	display: block;
	width: 100%;
	height: 100%;
}
</style>
{% endblock %}
{% block contentHeader %}
        Watched
        <small>Agent {{ agent.host }}</small>
{% endblock %}
{% block content %}
      <div class="row">
        <div class="col-md-3">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">Monitoring status</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
              <div class="row">
                <div class="col-md-8">
                  <div class="chart-responsive">
                    <canvas id="pieChart" height="150"></canvas>
                  </div>
                </div>
                <div class="col-md-4">
                  <ul class="chart-legend clearfix">
    {% for m in monitorStatus %}
    <li><i class="fa fa-circle-o {{ m.text }}"></i> {{ m.name }}<span class="pull-right">{{ m.cnt }}</span></li>
    {% endfor %}
                  </ul>
                </div>
              </div>
            </div>
            <div class="box-footer no-padding">
              <ul class="nav nav-pills nav-stacked">
    {% for e in activeEvent %}
                <li><a href="{{ path_for('event', { 'id': e.id|e }) }}">{{ e.decode }}.{{ e.property }}
                  <span class="pull-right {{ e.color }}">{{ e.current_value }}{{ e.encode }}{{ e.value }}</span></a></li>
    {% endfor %}
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">Events history</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body table-responsive">
	      <table class="table table-striped table-hover">
	      <thead><tr>
               <th>id</th>
               <th>start</th>
               <th>end</th>
               <th>ressource</th>
               <th>property</th>
               <th>value</th>
               <th>rule</th>
	      </tr></thead><tbody>
    {% for h in monitorHistory %}
               <tr class="{{ h.color }}">
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.id }}</a></td>
		<td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.start_time }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.end_time }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.decode }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.property }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.current_value }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.encode }}{{ h.value }}</a></td>
               </tr>
    {% endfor %}
	      </tbody>
	     </table>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">Monitoring items</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
              <div class="row">
                <div class="col-md-8">
                  <div class="chart-responsive">
                    <canvas id="pieChart2" height="150"></canvas>
                  </div>
                </div>
                <div class="col-md-4">
                  <ul class="chart-legend clearfix">
    {% for m in monitorItems %}
                    <li><i class="fa fa-circle-o {{ m.text }}"></i> {{ m.name }}<span class="pull-right">{{ m.cnt }}</span></li>
    {% endfor %}
                  </ul>
                </div>
              </div>
            </div>
            <div class="box-footer no-padding">
              <ul class="nav nav-pills nav-stacked">
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-2">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">CPU usage</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
    {% for s in cpuUsage %}
		<a href="{{ path_for('ressource', { 'aid': s.agent_id, 'rid': s.res_id }) }}">
                  <div class="clearfix">
                    <span class="pull-left">{{ s.decode }}</span>
                    <small class="pull-right">{{ s.pctused }}%</small>
                  </div>
                  <div class="progress xs">
                    <div class="progress-bar progress-bar-blue" style="width: {{ s.pctused }}%;"></div>
                  </div>
		</a>
    {% endfor %}
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">Memory usage (MB)</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
		<div id="memory-usage" style="height: 250px;"></div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">Storage status</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
    {% for s in storageStatus %}
		<a href="{{ path_for('ressource', { 'aid': s.agent_id, 'rid': s.res_id }) }}">
                  <div class="clearfix">
                    <span class="pull-left">{{ s.decode }}</span>
                    <small class="pull-right">{{ s.pctused }}%</small>
                  </div>
                  <div class="progress xs">
                    <div class="progress-bar progress-bar-green" style="width: {{ s.pctused }}%;"></div>
                  </div>
		</a>
    {% endfor %}
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">Statistics</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
    {% for s in stats %}
		<a href="{{ path_for('ressource', { 'aid': s.agent_id, 'rid': s.res_id }) }}">
                  <div class="clearfix">
                    <span class="pull-left">{{ s.name }}</span>
                  </div>
		</a>
    {% endfor %}
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">Other ressources</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
    {% for s in ressources %}
		<a href="{{ path_for('ressource', { 'aid': s.agent_id, 'rid': s.res_id }) }}">
                  <div class="clearfix">
                    <span class="pull-left">{{ s.name }}</span>
                  </div>
		</a>
    {% endfor %}
            </div>
          </div>
        </div>

     </div>
{% endblock %}

{% block scripts %}
<script>
  var pieChartCanvas = $("#pieChart").get(0).getContext("2d");
  var pieChart = new Chart(pieChartCanvas);
  var pieChartCanvas2 = $("#pieChart2").get(0).getContext("2d");
  var pieChart2 = new Chart(pieChartCanvas2);
  var PieData1 = [];
    {% for m in monitorStatus %}
  PieData1.push({
      value: {{ m.cnt }},
      color: "{{ m.color }}",
      highlight: "{{ m.color }}",
      label: "{{ m.name }}"
    });
    {% endfor %}

  var PieData2 = [];
    {% for m in monitorItems %}
  PieData2.push({
      value: {{ m.cnt }},
      color: "{{ m.color }}",
      highlight: "{{ m.color }}",
      label: "{{ m.name }}"
    });
    {% endfor %}

  var pieOptions = {
    segmentShowStroke: true,
    segmentStrokeColor: "#fff",
    segmentStrokeWidth: 1,
    percentageInnerCutout: 50, // This is 0 for Pie charts
    animationSteps: 100,
    animationEasing: "easeOutBounce",
    animateRotate: true,
    animateScale: false,
    responsive: true,
    maintainAspectRatio: false,
    tooltipTemplate: "<%=label%> - <%=value %>"
  };
  pieChart.Doughnut(PieData1, pieOptions);
  pieChart2.Doughnut(PieData2, pieOptions);

Morris.Bar({
  element: 'memory-usage',
  data: [
    {% for m in memoryUsage %}
      { type: '{{ m.name }}', used: {{ m.used }}, free: {{ m.free }}, url: "{{ path_for('ressource', { 'aid': m.agent_id, 'rid': m.res_id }) }}" },
    {% endfor %}
  ],
  xkey: 'type',
  ykeys: ['used', 'free'],
  stacked: true,
  hideHover: true,
  labels: ['Used', 'Free']
}).on('click', function(i, row){
  location.href=row["url"];
});
</script>
{% endblock %}

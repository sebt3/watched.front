{% extends "core.twig" %}
{% block title %}{{ _('Apps') }} - {{ _('Modify') }}{% endblock %}
{% block contentHeader %}
        {{ _('Apps') }}
        <small>{{ _('Modify an application') }}</small>
{% endblock %}
{% block content %}
    {% for a in services %}
<div class="modal fade modal-warning" id="deleteService{{ app_id }}-{{ a.id }}" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">{{ _('Remove service from this application') }}</h4>
      </div>
      <div class="modal-body">
	      <p>{{ _('Are you sure you want to remove this service from this application:') }}</p>
	      <div class="row">
		<div class="col-md-2"><strong class='pull-right'>{{ _('Apps') }}</strong></div>
		<div class="col-md-10">{{ name }}</div>
	      </div>
	      <div class="row">
		<div class="col-md-2"><strong class='pull-right'>{{ _('Domain') }}</strong></div>
		<div class="col-md-10">{{ a.domain_name }}</div>
	      </div>
	      <div class="row">
		<div class="col-md-2"><strong class='pull-right'>{{ _('Host') }}</strong></div>
		<div class="col-md-10">{{ a.host_name }}</div>
	      </div>
	      <div class="row">
		<div class="col-md-2"><strong class='pull-right'>{{ _('Service') }}</strong></div>
		<div class="col-md-10">{{ a.name }}</div>
	      </div>
      </div>
      <div class="modal-footer">
	<form action="{{ path_for('admin.apps.deleteService', { 'id': app_id, 'sid': a.id }) }}" method="post">
          <button type="submit" class="btn btn-outline">{{ _('Confirm') }}</button>
	</form>
      </div>
    </div>
  </div>
</div>
    {% endfor %}
    {% for a in teams %}
<div class="modal fade modal-warning" id="deleteTeam{{ app_id }}-{{ a.team_id }}-{{ a.role_id }}" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">{{ _('Remove a team from an application') }}</h4>
      </div>
      <div class="modal-body">
	      <p>{{ _('Are you sure you want to remove this team from this application:') }}</p>
	      <div class="row">
		<div class="col-md-2"><strong class='pull-right'>{{ _('Apps') }}</strong></div>
		<div class="col-md-10">{{ name }}</div>
	      </div>
	      <div class="row">
		<div class="col-md-2"><strong class='pull-right'>{{ _('Type') }}</strong></div>
		<div class="col-md-10">{{ a.type }}</div>
	      </div>
	      <div class="row">
		<div class="col-md-2"><strong class='pull-right'>{{ _('Team') }}</strong></div>
		<div class="col-md-10">{{ a.team_name }}</div>
	      </div>
	      <div class="row">
		<div class="col-md-2"><strong class='pull-right'>{{ _('Role') }}</strong></div>
		<div class="col-md-10">{{ a.role_name }}</div>
	      </div>
      </div>
      <div class="modal-footer">
	<form action="{{ path_for('admin.apps.deleteTeam', { 'id': app_id, 'tid': a.team_id, 'rid': a.role_id }) }}" method="post">
          <button type="submit" class="btn btn-outline">{{ _('Confirm') }}</button>
	</form>
      </div>
    </div>
  </div>
</div>
    {% endfor %}
      <div class="row">
        <div class="col-md-6">
          <div class="box box-info">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Modify an application') }}</h3>
            </div>
            <form class="form-horizontal" action="{{ path_for('admin.apps.change', {'id': app_id}) }}" method="post">
              <div class="box-body">

                <div class="form-group">
                  <label for="name" class="col-sm-2 control-label">{{ _('Name') }}</label>
                  <div class="col-sm-10">
                    <input type="name" class="form-control" id="name" name="name" placeholder="{{ _('Name') }}" {% if name %} value="{{name}}" {% endif %}>
                  </div>
                </div>

                <div class="form-group">
                  <label for="group_id" class="col-sm-2 control-label">{{ _('Group') }}</label>
                  <div class="col-sm-10">
		    <select class="form-control" name='group_id'>
			<option {% if not app.group_id %} selected="selected"{% endif %} value=0>{{ _('None') }}</option>
    {% for a in group %}
			<option {% if a.id==app.group_id %} selected="selected"{% endif %} value={{ a.id }}>{{ a.name }}</option>
    {% endfor %}
		    </select>
                  </div>
                </div>

              <div class="box-footer">
                <a href="{{ path_for('admin.apps.list') }}" class="btn btn-default"><i class="fa fa-arrow-left" aria-hidden="true"></i> {{ _('Cancel') }}</a>
                <button type="submit" class="btn btn-info pull-right"><i class="fa fa-pencil"></i> {{ _('update') }}</button>
              </div>
              </div>
            </form>
          </div>
          <div class="box box-normal">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Teams') }}</h3>
	      <a class="btn btn-default btn-flat pull-right" href="{{ path_for('admin.apps.addTeam', { 'id': app_id }) }}">
		<i class="fa fa-plus" aria-hidden="true"></i> {{ _('Add') }}
	      </a>
            </div>
              <div class="box-body table-responsive">
	      <table class="table table-striped table-hover" id="team">
	      <thead><tr>
               <th class="sortable">{{ _('Team') }}</th>
               <th class="sortable">{{ _('Role') }}</th>
               <th class="sortable">{{ _('Alert') }}</th>
               <th class='pull-right'>{{ _('actions') }}</th>
	      </tr></thead><tbody>
	      </tbody>
	     </table>
              </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="box box-normal">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Services') }}</h3>
	      <a class="btn btn-default btn-flat pull-right" href="{{ path_for('admin.apps.addService', {'id': app_id}) }}">
		<i class="fa fa-plus" aria-hidden="true"></i> {{ _('Add') }}
	      </a>
            </div>
              <div class="box-body table-responsive">
	      <table class="table table-striped table-hover" id="service">
	      <thead><tr>
               <th class="sortable">{{ _('Domain') }}</th>
               <th class="sortable">{{ _('Host') }}</th>
               <th class="sortable">{{ _('Service') }}</th>
               <th class='pull-right'>{{ _('actions') }}</th>
	      </tr></thead><tbody>
	      </tbody>
	     </table>
              </div>
          </div>
        </div>
      </div>
{% endblock %}
{% block scripts %}
<script src="/js/watched.tables.js"></script>
<script>
  myService = watchedTable("service", [
    {% for a in services %}
      {
	domain:	{ "text": "{{ a.domain_name }}", "url": "{{ path_for('admin.domains.change', { 'id': a.domain_id  }) }}"},
	host:	"{{ a.host_name }}",
	name:	"{{ a.name }}",
	actions: [ { icon:"fa fa-trash",  target: "#deleteService{{ app_id }}-{{ a.id }}" } ]
      },
    {% endfor %}
  ]);
  myTeam = watchedTable("team", [
    {% for a in teams %}
      {
	team:	{ "text": "{{ a.team_name }}", "url": "{{ path_for('admin.teams.change', { 'id': a.team_id }) }}"},
	role:	{ "text": "{{ a.role_name }}", "url": "{{ path_for('admin.roles.change', { 'id': a.role_id }) }}"},
	alert:	"{{ _(a.send) }}",
	actions: [ { icon:"fa fa-wrench", url: "{{ path_for('admin.apps.changeTeam', { 'id': app_id, 'tid': a.team_id, 'rid': a.role_id }) }}" },
		   { icon:"fa fa-trash",  target: "#deleteTeam{{ app_id }}-{{ a.team_id }}-{{ a.role_id }}" } ]
      },
    {% endfor %}
  ]);
</script>
{% endblock %}

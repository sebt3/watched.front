{% extends "core.twig" %}
{% block title %}Dashboard {% endblock %}
{% block meta %}
<style>
table.table-hover tr td a {
	display: block;
	width: 100%;
	height: 100%;
}
</style>
{% endblock %}
{% block contentHeader %}
        {{ _('Dashboard') }}
        <small>{{ _('overview') }}</small>
{% endblock %}
{% block content %}
      <div class="row">
        <div class="col-md-4">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Monitoring status') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
	    <div class="box-body" id="gfx1"></div>
            <div class="box-footer no-padding">
              <ul class="nav nav-pills nav-stacked">
    {% for e in activeEvent %}
                <li><a href="{{ path_for('event', { 'id': e.id|e }) }}">{{ e.decode }}.{{ e.property }}
                  <span class="pull-right {{ e.color }}">{{ e.current_value }}{{ e.encode }}{{ e.value }}</span></a></li>
    {% endfor %}
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('All monitoring item by types') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
	    <div class="box-body" id="gfx2"></div>
            <div class="box-footer no-padding">
              <ul class="nav nav-pills nav-stacked">
              </ul>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Hosts by domain') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
	    <div class="box-body" id="gfx3"></div>
            <div class="box-footer no-padding">
              <ul class="nav nav-pills nav-stacked">
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-7">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Current events') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body table-responsive">
	      <table class="table table-striped table-hover">
	      <thead><tr>
               <th>{{ _('id') }}</th>
               <th>{{ _('since') }}</th>
               <th>{{ _('host') }}</th>
               <th>{{ _('ressource') }}</th>
               <th>{{ _('property') }}</th>
               <th>{{ _('value') }}</th>
               <th>{{ _('rule') }}</th>
	      </tr></thead><tbody>
    {% for h in events %}
               <tr class="{{ h.color }}">
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.id }}</a></td>
		<td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.start_time }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.host_name }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.decode }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.property }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.current_value }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('event', { 'id': h.id }) }}">{{ h.encode }}{{ h.value }}</a></td>
               </tr>
    {% endfor %}
	      </tbody>
	     </table>
            </div>
          </div>
        </div>
{% if menu.isAuth %}
        <div class="col-md-5">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Failed services') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body table-responsive">
	      <table class="table table-striped table-hover">
	      <thead><tr>
               <th>{{ _('host') }}</th>
               <th>{{ _('service') }}</th>
               <th>{{ _('since') }}</th>
               <th>{{ _('status') }}</th>
	      </tr></thead><tbody>
    {% for h in services %}
               <tr class="{{ h.color }}">
                <td><a  class="{{ h.color }}" href="{{ path_for('service', { 'sid': h.serv_id, 'hid': h.host_id }) }}">{{ h.host }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('service', { 'sid': h.serv_id, 'hid': h.host_id }) }}">{{ h.service }}</a></td>
		<td><a  class="{{ h.color }}" href="{{ path_for('service', { 'sid': h.serv_id, 'hid': h.host_id }) }}">{{ h.timestamp }}</a></td>
                <td><a  class="{{ h.color }}" href="{{ path_for('service', { 'sid': h.serv_id, 'hid': h.host_id }) }}">{{ _(h.status) }}</a></td>
               </tr>
    {% endfor %}
	      </tbody>
	     </table>
            </div>
          </div>
        </div>
{% endif %}
      </div>

     </div>
{% endblock %}
{% block scripts %}
<script src="/js/watched.donut.js"></script>
<script>
  watchedDonut("gfx1",  [
    {% for m in monitorStatus %}
    {
      value: {{ m.cnt }},
      color: "{{ m.color }}",
      label: "{{ _(m.name) }}"
    },
    {% endfor %}
  ]);
  watchedDonut("gfx2", [
    {% for m in monitorItems %}
    {
      value: {{ m.cnt }},
      color: "{{ m.color }}",
      label: "{{ _(m.name) }}"
    },
    {% endfor %}
  ]);
  watchedDonut("gfx3", [
    {% for m in domains %}
    {
      value: {{ m.cnt }},
      color: "{{ m.color }}",
      label: "{{ _(m.name) }}"
    },
    {% endfor %}
  ]);

</script>
{% endblock %}

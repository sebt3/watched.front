{% extends "core.twig" %}
{% block title %}{{ _('Host') }} {{ host.host }} {% endblock %}
{% block meta %}
<style>
table.table-hover tr td a {
	display: block;
	width: 100%;
	height: 100%;
}
</style>
{% endblock %}
{% block contentHeader %}
        {{ _('Host') }}
        <small>{{ host.host }}</small>
{% endblock %}
{% block content %}
      <div class="row">
        <div class="col-md-3">
          <div class="box box-default">
            <div class="box-header with-border">
		    <h3 class="box-title">{{ _('Monitoring status') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
	    <div class="box-body" id="gfx1"></div>
            <div class="box-footer no-padding">
              <ul class="nav nav-pills nav-stacked">
    {% for e in activeEvent %}
                <li><a class="{{ e.color }}" href="{{ path_for('event', { 'id': e.id|e }) }}">{{ e.decode }}.{{ e.property }}
                  <span class="pull-right {{ e.color }}">{{ e.current_value }}{{ e.encode }}{{ e.value }}</span></a></li>
    {% endfor %}
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Events history') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body table-responsive">
	      <table class="table table-striped table-hover" id="sort">
	      <thead><tr>
               <th class="sortable">{{ _('id') }}</th>
               <th class="sortable">{{ _('start') }}</th>
               <th class="sortable">{{ _('end') }}</th>
               <th class="sortable">{{ _('ressource') }}</th>
               <th class="sortable">{{ _('property') }}</th>
               <th class="sortable">{{ _('value') }}</th>
               <th class="sortable">{{ _('rule') }}</th>
	      </tr></thead><tbody>
	      </tbody>
	     </table>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Monitoring item types') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
	    <div class="box-body" id="gfx2"></div>
            <div class="box-footer no-padding">
              <ul class="nav nav-pills nav-stacked">
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-3">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Services') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
    {% for s in services %}
		<a href="{{ path_for('service', { 'hid': host.id, 'sid': s.serv_id }) }}">
                  <div class="clearfix">
                    <span class="pull-left {{ s.color }}">{{ s.name }}</span>
                  </div>
		</a>
    {% endfor %}
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Memory usage (MB)') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
		<div id="memory-usage" style="height: 250px;"></div>
            </div>
          </div>
        </div>

        <div class="col-md-2">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('CPU usage') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
    {% for s in cpuUsage %}
		<a href="{{ path_for('ressource', { 'aid': s.host_id, 'rid': s.res_id }) }}">
                  <div class="clearfix">
                    <span class="pull-left">{{ s.decode }}</span>
                    <small class="pull-right">{{ s.pctused }}%</small>
                  </div>
                  <div class="progress xs">
		    <div class="progress-bar progress-bar-red" style="width: {{ s.user }}%;"></div>
		    <div class="progress-bar progress-bar-yellow" style="width: {{ s.system }}%;"></div>
		    <div class="progress-bar progress-bar-green" style="width: {{ s.nice }}%;"></div>
		    <div class="progress-bar progress-bar-blue" style="width: {{ s.iowait }}%;"></div>
		    <div class="progress-bar progress-bar-light-blue" style="width: {{ s.irq }}%;"></div>
		    <div class="progress-bar progress-bar-aqua" style="width: {{ s.softirq }}%;"></div>
                  </div>
		</a>
    {% endfor %}
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Storage status') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
    {% for s in storageStatus %}
		<a href="{{ path_for('ressource', { 'aid': s.host_id, 'rid': s.res_id }) }}">
                  <div class="clearfix">
                    <span class="pull-left">{{ s.decode }}</span>
                    <small class="pull-right">{{ s.pctused }}%</small>
                  </div>
                  <div class="progress xs">
                    <div class="progress-bar progress-bar-{{ s.color }}" style="width: {{ s.pctused }}%;"></div>
                  </div>
		</a>
    {% endfor %}
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Statistics') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
    {% for s in stats %}
		<a href="{{ path_for('ressource', { 'aid': s.host_id, 'rid': s.res_id }) }}">
                  <div class="clearfix">
                    <span class="pull-left">{{ s.name }}</span>
                  </div>
		</a>
    {% endfor %}
            </div>
          </div>
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Other ressources') }}</h3>
              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
            </div>
            <div class="box-body">
    {% for s in ressources %}
		<a href="{{ path_for('ressource', { 'aid': s.host_id, 'rid': s.res_id }) }}">
                  <div class="clearfix">
                    <span class="pull-left">{{ s.name }}</span>
                  </div>
		</a>
    {% endfor %}
            </div>
          </div>
        </div>

     </div>
{% endblock %}

{% block scripts %}
<script src="/js/watched.donut.js"></script>
<script src="/js/watched.bar.js"></script>
<script src="/js/watched.tables.js"></script>
<script>
  myTable = watchedTable("sort", [
    {% for h in monitorHistory %}
      {
	id:	{ "text": "{{ h.id }}", "color": "{{ h.color }}",  "url": "{{ path_for('event', { 'id': h.id }) }}"},
	stime:	{ "text": "{{ h.start_time }}", "color": "{{ h.color }}",  "url": "{{ path_for('event', { 'id': h.id }) }}"},
	etime:	{ "text": "{{ h.end_time }}", "color": "{{ h.color }}",  "url": "{{ path_for('event', { 'id': h.id }) }}"},
	res:	{ "text": "{{ h.decode }}", "color": "{{ h.color }}",  "url": "{{ path_for('event', { 'id': h.id }) }}"},
	prop:	{ "text": "{{ h.property }}", "color": "{{ h.color }}",  "url": "{{ path_for('event', { 'id': h.id }) }}"},
	value:	{ "text": "{{ h.current_value }}", "color": "{{ h.color }}",  "url": "{{ path_for('event', { 'id': h.id }) }}"},
	rule:	{ "text": "{{ h.encode }}{{ h.value }}", "color": "{{ h.color }}",  "url": "{{ path_for('event', { 'id': h.id }) }}"},
      },
    {% endfor %}
  ]);
  myMonitor = watchedDonut("gfx1", [
    {% for m in monitorStatus %}
    {
      value: {{ m.cnt }},
      color: "{{ m.color }}",
      label: "{{ _(m.name) }}"
    },
    {% endfor %}
  ]);
  myItems = watchedDonut("gfx2", [
    {% for m in monitorItems %}
    {
      value: {{ m.cnt }},
      color: "{{ m.color }}",
      label: "{{ _(m.name) }}"
    },
    {% endfor %}
  ]);
  myMemory = watchedMemSwap('memory-usage',[
    {% for m in memoryUsage %}
      { type: '{{ m.name }}', used: {{ m.used }}, free: {{ m.free }}, url: "{{ path_for('ressource', { 'aid': m.host_id, 'rid': m.res_id }) }}" },
    {% endfor %}
  ]);
</script>
{% endblock %}

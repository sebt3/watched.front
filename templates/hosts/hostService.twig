{% extends "core.twig" %}
{% block title %}{{ _('Service') }} {{ service.name }}{% endblock %}
{% block contentHeader %}
        {{ _('Service') }}
        <small>{{ service.name }}</small>
{% endblock %}
{% block scripts %}
<script src="/js/watched.tables.js"></script>
<script src="/js/watched.service.js"></script>
<script>
chart = wdServiceChart().baseUrl("{{ path_for('apiService', { 'id': service.id }) }}");
d3.select('section.content').call(
	wdUnion().item(wdRow()
		 .cell('col-md-8', wdBox().title("{{ _('Process') }}")
			.tool({action:'collapse', icon:'fa fa-minus'})
			.body(wdTableChart()
				.col("{{ _('name') }}")
				.col("{{ _('path') }}")
				.col("{{ _('cwd') }}")
				.col("{{ _('username') }}")
				.col("{{ _('last check') }}")
				.col("{{ _('status') }}")
				.body([
        {% for a in service.process %}{
		name:	"{{ a.process_name }}",
		path:	"{{ a.full_path }}",
		cwd:	"{{ a.cwd }}",
		uname:	"{{ a.username }}",
		time:	"{{ a.timestamp }}",
		status:	{  color: "{{ a.color }}", text: "{{ a.status }}" },
	},{% endfor %}
				])
		)).cell('col-md-4', wdBox().title("{{ _('Sockets') }}")
			.tool({action:'collapse', icon:'fa fa-minus'})
			.body(wdTableChart()
				.col("{{ _('listen') }}")
				.col("{{ _('last check') }}")
				.col("{{ _('status') }}")
				.body([
        {% for a in service.sockets %}{
		name:	"{{ a.socket_name }}",
		time:	"{{ a.timestamp }}",
		status:	{  color: "{{ a.color }}", text: "{{ a.status }}" },
	},{% endfor %}
				])
	))).item(wdBox().title("{{ _('Availability') }}")
			.tool(wdDropButton().text('Period')
				.item("{{ _('All') }}", 'chart.setPeriod("all")')
				.item("{{ _('Last month') }}", 'chart.setPeriod("month")')
				.item("{{ _('Last week') }}", 'chart.setPeriod("week")')
				.item("{{ _('Yesterday') }}", 'chart.setPeriod("yesterday")')
				.item("{{ _('Today') }}", 'chart.setPeriod("today")')
				.item("{{ _('Last hour') }}", 'chart.setPeriod("hour")')
			).body(chart)
));
</script>
{% endblock %}

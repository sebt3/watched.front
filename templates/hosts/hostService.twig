{% extends "core.twig" %}
{% block title %}{{ _('Service') }} {{ service.name }}{% endblock %}
{% block contentHeader %}
        {{ _('Service') }}
        <small>{{ service.name }}</small>
{% endblock %}
{% block content %}
      <div class="row">
        <div class="col-md-8">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">Process</h3>
            </div>
	    <div class="box-body">
	      <table class="table table-striped table-hover" id="procs">
	      <thead><tr>
               <th class="sortable">{{ _('name') }}</th>
               <th class="sortable">{{ _('path') }}</th>
               <th class="sortable">{{ _('cwd') }}</th>
               <th class="sortable">{{ _('username') }}</th>
               <th class="sortable">{{ _('last check') }}</th>
               <th class="sortable">{{ _('status') }}</th>
	      </tr></thead><tbody>
	      </tbody></table>
	    </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Sockets') }}</h3>
            </div>
	    <div class="box-body">
	      <table class="table table-striped table-hover" id="socks">
	      <thead><tr>
               <th class="sortable">{{ _('listen') }}</th>
               <th class="sortable">{{ _('last check') }}</th>
               <th class="sortable">{{ _('status') }}</th>
	      </tr></thead><tbody>
	      </tbody></table>
	     </div>
	    </div>
          </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <div class="box box-default">
            <div class="box-header with-border">
              <h3 class="box-title">{{ _('Availability') }}</h3>
	      <div class="box-tools">
                    <div class="btn-group">
                      <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                          Period <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                          <li><a onclick="chart.setPeriod('all')">{{ _('All') }}</a></li>
                          <li><a onclick="chart.setPeriod('month')">{{ _('Last month') }}</a></li>
                          <li><a onclick="chart.setPeriod('week')">{{ _('Last week') }}</a></li>
                          <li><a onclick="chart.setPeriod('yesterday')">{{ _('Yesterday') }}</a></li>
                          <li><a onclick="chart.setPeriod('today')">{{ _('Today') }}</a></li>
                          <li><a onclick="chart.setPeriod('hour')">{{ _('Last hour') }}</a></li>
                        </ul>
                      </div>
                    </div>
	      </div>
            </div>
            <div class="box-body">
	     <div class="chart">
	      <div id="morrisChart"></div>
	     </div>
            </div>
          </div>
        </div>
      </div>
{% endblock %}

{% block scripts %}
<script src="/js/watched.tables.js"></script>
<script src="/js/watched.service.js"></script>
<script>
mySock = watchedTable("socks", [
        {% for a in service.sockets %}
      {
	name:	"{{ a.socket_name }}",
	time:	"{{ a.timestamp }}",
	status:	{  "color": "{{ a.color }}", "text": "{{ a.status }}" },
      },
        {% endfor %}
  ]);
myProc = watchedTable("procs", [
        {% for a in service.process %}
      {
	name:	"{{ a.process_name }}",
	path:	"{{ a.full_path }}",
	cwd:	"{{ a.cwd }}",
	uname:	"{{ a.username }}",
	time:	"{{ a.timestamp }}",
	status:	{  "color": "{{ a.color }}", "text": "{{ a.status }}" },
      },
        {% endfor %}
  ]);
chart = watchedService('morrisChart', "{{ path_for('apiService', { 'id': service.id }) }}");
</script>
{% endblock %}

